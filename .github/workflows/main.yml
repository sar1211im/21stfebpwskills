# .github/workflows/ci.yml
# name: Python CI with Coverage
 
# on:
#   push:
#     branches: [ main, develop ]
#   pull_request:
#     branches: [ main ]
 
# jobs:
#   test:
#     runs-on: ubuntu-latest
 
#     strategy:
#       matrix:
#         python-version: ["3.10", "3.11", "3.12"]
 
#     steps:
#       # Step 1: Checkout code
#       - name: Checkout repository
#         uses: actions/checkout@v4
 
#       # Step 2: Set up Python
#       - name: Set up Python ${{ matrix.python-version }}
#         uses: actions/setup-python@v5
#         with:
#           python-version: ${{ matrix.python-version }}
 
#       # Step 3: Cache pip packages
#       - name: Cache pip packages
#         uses: actions/cache@v4
#         with:
#           path: ~/.cache/pip
#           key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
 
#       # Step 4: Install dependencies
#       - name: Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           pip install -r requirements.txt
 
#       # Step 5: Run tests with coverage
#       - name: Run tests with coverage
#         run: |
#           pytest --cov=src \
#                  --cov-report=term-missing \
#                  --cov-report=xml \
#                  --cov-report=html \
#                  --cov-fail-under=80 \
#                  tests/
 
#       # Step 6: Upload HTML report as artifact
#       - name: Upload coverage HTML report
#         uses: actions/upload-artifact@v4
#         with:
#           name: coverage-report-py${{ matrix.python-version }}
#           path: htmlcov/
#           retention-days: 7
 
      # Step 7: Upload to Codecov
      # - name: Upload to Codecov
      #   uses: codecov/codecov-action@v4
      #   with:
      #     files: ./coverage.xml
      #     fail_ci_if_error: true
      #     token: ${{ secrets.CODECOV_TOKEN }}
      
# name: Python CI with Coverage

# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main

# jobs:
#   test:
#     runs-on: ubuntu-latest
#     strategy:
#       matrix:
#         python-version:
#           - "3.10"
#           - "3.11"
#           - "3.12"

#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Set up Python ${{ matrix.python-version }}
#         uses: actions/setup-python@v5
#         with:
#           python-version: ${{ matrix.python-version }}

#       - name: Cache pip packages
#         uses: actions/cache@v4
#         with:
#           path: ~/.cache/pip
#           key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}

#       - name: Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           pip install -r requirements.txt

#       - name: Run tests with coverage
#         run: |
#           pytest --cov=src \
#                  --cov-report=term-missing \
#                  --cov-report=xml \
#                  --cov-report=html \
#                  --cov-fail-under=80 \
#                  tests/

#       # ------------------------------
#       # TXT COVERAGE FILE
#       # ------------------------------
#       - name: Generate TXT coverage report
#         run: coverage report > coverage.txt

#       - name: Upload TXT coverage report
#         uses: actions/upload-artifact@v4
#         with:
#           name: coverage-report-py${{ matrix.python-version }}.txt
#           path: coverage.txt
#           retention-days: 7

#       # ------------------------------
#       # HTML COVERAGE FILE (ONLY index.html)
#       # ------------------------------
#       - name: Upload HTML coverage report
#         uses: actions/upload-artifact@v4


#         with:
#           name: coverage-report-py${{ matrix.python-version }}.html
#           path: htmlcov/index.html
#           retention-days: 7
          
# name: Python CI with Coverage
# on:
#   push:
#     branches:
#       - main
#       - develop
#   pull_request:
#     branches:
#       - main
# jobs:
#   test:
#     runs-on: ubuntu-latest
#     strategy:
#       matrix:
#         python-version:
#           - "3.10"
#           - "3.11"
#           - "3.12"
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Set up Python ${{ matrix.python-version }}
#         uses: actions/setup-python@v5
#         with:
#           python-version: ${{ matrix.python-version }}

#       - name: Cache pip packages
#         uses: actions/cache@v4
#         with:
#           path: ~/.cache/pip
#           key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}

#       - name: Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           pip install -r requirements.txt

#       - name: Run tests with coverage
#         run: |
#           pytest --cov=src \
#                  --cov-report=term-missing \
#                  --cov-report=xml \
#                  --cov-report=html \
#                  tests/

#       # ------------------------------
#       # SAVE HTML REPORT TO REPO
#       # ------------------------------
#       - name: Copy HTML coverage report to repo folder
#         run: |
#           mkdir -p coverage-reports/py${{ matrix.python-version }}
#           cp -r htmlcov/. coverage-reports/py${{ matrix.python-version }}/

#       - name: Commit coverage HTML report
#         run: |
#           git config user.name "github-actions[bot]"
#           git config user.email "github-actions[bot]@users.noreply.github.com"


name: Python CI with Coverage

permissions:
  contents: write   # <-- REQUIRED so GitHub Actions can push commits

on:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version:
          - "3.10"
          - "3.11"
          - "3.12"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ matrix.python-version }}

      - name: Cache pip packages
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run tests with coverage
        run: |
          pytest --cov=src \
#           git add coverage-reports/
#           git diff --cached --quiet || git commit -m "ci: update coverage report for py${{ matrix.python-version }} [skip ci]"
#           git push
  
